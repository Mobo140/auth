# Auth Service

Auth Service - это микросервис аутентификации и авторизации, разработанный на Go с использованием gRPC. Сервис предоставляет функционал управления пользователями, аутентификации и контроля доступа.

## Функциональность

### Аутентификация

- Логин пользователей с использованием username/password
- Система двух токенов (refresh/access)
- Проверка доступа к защищенным эндпоинтам

### Управление пользователями

- Создание пользователей с подтверждением пароля
- Получение информации о пользователе по ID
- Получение списка пользователей с пагинацией
- Обновление информации пользователя
- Удаление пользователей

## Технологический стек

- Go 1.21+
- gRPC/Protobuf
- PostgreSQL (хранение пользователей)
- Redis (кэширование)
- Jaeger (трейсинг)
- gRPC Gateway (REST API)
- Swagger (документация)
- Grafana (визуализация данных)
- Prometheus (мониторинг)
- Zap (логирование)

## API

### User Service (user_v1)

Управление пользователями:

- Create - создание нового пользователя
- Get - получение информации о пользователе по ID
- GetUsers - получение списка пользователей с пагинацией
- Update - обновление информации пользователя
- Delete - удаление пользователя

### Auth Service (auth_v1)

Аутентификация:

- Login - аутентификация пользователя и получение refresh token
- GetRefreshToken - обновление refresh token
- GetAccessToken - получение access token по refresh token

### Access Service (access_v1)

Авторизация:

- Check - проверка доступа к защищенным эндпоинтам

## Особенности реализации

### Безопасность

- Хеширование паролей перед сохранением
- Система JWT токенов для аутентификации
- Система ролей для авторизации
- Механизм refresh/access токенов

### Производительность

- Кэширование данных пользователей в Redis
- Использование транзакций для обеспечения целостности данных
- Оптимизированные запросы к базе данных

### Мониторинг и логирование

- Трейсинг запросов через Jaeger
- Структурированное логирование с использованием Zap
- Метрики для мониторинга производительности

## Процесс аутентификации

### Получение токенов

1. Пользователь отправляет логин/пароль через метод Login
2. Сервис проверяет учетные данные и возвращает refresh token
3. Клиент использует refresh token для получения access token
4. Access token используется для доступа к защищенным ресурсам

### Жизненный цикл токенов

- Access token: короткоживущий (15 минут), используется для доступа к API
- Refresh token: долгоживущий (24 часа), используется для обновления access token
- При истечении refresh token требуется повторная аутентификация

## Взаимодействие с другими сервисами

### Схема взаимодействия

1. Клиент -> Auth Service: аутентификация и получение токенов
2. Клиент -> Другие сервисы: запрос с access token
3. Другие сервисы -> Auth Service: проверка валидности токена
4. Auth Service -> Другие сервисы: подтверждение/отказ в доступе

### Процесс проверки доступа

1. Сервис получает запрос с access token
2. Вызывает метод Check в Auth Service
3. Auth Service проверяет:
   - Валидность токена
   - Права доступа (роли)
   - Срок действия токена
4. Возвращает результат проверки

## Роли и права доступа

### Доступные роли

- Admin (1): полный доступ ко всем эндпоинтам
- User (2): ограниченный доступ к пользовательским функциям
- Guest (3): доступ только к публичным эндпоинтам

### Матрица доступа

- Управление пользователями: только Admin
- Просмотр информации: Admin и User
- Публичные эндпоинты: все роли
